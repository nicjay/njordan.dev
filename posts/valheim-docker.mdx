---
title: Valheim x Docker
description: Host your own Vikings sandbox at home.
image: /images/valheim-docker/cover.jpg
date: 010/11/22
---

[Valheim](https://store.steampowered.com/app/892970/Valheim/) is a PC game all about exploring beautiful procedurally generated biomes, defending yourself from waves of unique threats, or spending an hour or four deciding if the fur rug goes by the front door or in the hallway. Most enjoyably, it's the relaxing, immersive atmosphere that keeps me and my friends coming back.

Valheim runs via standard client-server communication, with a caveat being there isn't any "official" hosted server. Typically, a player launches the game, starts up a new world on their PC, and give their friends the local server name and password to connect. This is easy enough, but has a number of considerations - the biggest being that hosting player has to be online or keep the game running for anyone else who wants to keep playing and progressing in that world. I'm sure you'd like to take a nap every once in a while.

Fortunately, the game supports dedicated servers, which means that you can serve your game world (and your epic bases you spent a month building) independent of the game client, independent of your gaming machine, or even independent your household. There's two options: find and pay a third-party provider to host it for you, or sure enough, host it yourself on hardware at home.

Enter [Docker](https://www.ibm.com/cloud/learn/docker). More accurately, the possibility of _containerizing_ said servers. The container has everything it needs to run. Combined with [Docker Compose](https://docs.docker.com/compose/), it becomes almost ridiculously easy to boot up services of all kinds. There's many different ways to approach this, but I'll document my relatively bare-bones approach with a Linux-based OS and Docker (with Compose). You'll probably need just a little bit of basic command line know-how too.

## Prerequisites

- Docker
- An internet connection.

You'll need to [install Docker](https://docs.docker.com/engine/install/#supported-platforms), for which given the wealth of platforms, exact instructions can vary. It's widely supported by all major operating systems and many vendors, as either a downloadable executable or package from the above link. I run my containers on a Synology NAS, which also conveniently provides a one-click package manager in their GUI. You could even run it on a [Raspberry Pi](https://dev.to/elalemanyo/how-to-install-docker-and-docker-compose-on-raspberry-pi-1mo) if you're into that. In most cases Docker also comes with Compose, a YAML-based configuration format that lets you keep the entirety of your setups saved in one file.

At the end of the day, if you can enter `docker` and `docker-compose` commands in your favorite terminal, you're golden. Note there may be some OS-specific nuances, like permissions or filepaths, which will be dependent on your configuration. I'm most familiar with a Linux environment.

![](/images/valheim-docker/command_line.jpg 'Docker Command line')

## Docker Image

Now, we're ready to start configuring the game server itself.

For context, the Valheim Dedicated Server is freely available for download, independent of the game. It'll show up under Tools in a Steam library, or more relevant to containerization, via a [SteamCMD](https://developer.valvesoftware.com/wiki/SteamCMD) download given an [App ID](https://steamdb.info/app/896660/). Also note that if you don't own Valheim yet, why not? ðŸ˜–

While the binaries are freely available to spin up our own Dockerfile and create our _own_ image, we don't necessarily need to do that. To get something running, we can take advantage of Docker Registries, a distribution system for images. Fortunately, a number of awesome individuals have done the hard part already and provided images to consume, containing logic to auto-download the game server and many additional features. Here's a few examples:

- [lloesche/valheim-server-docker](https://github.com/lloesche/valheim-server-docker)
- [mbround18/valheim-docker](https://github.com/mbround18/valheim-docker)
- [sethmachine/valheim-server-docker](https://github.com/sethmachine/valheim-server-docker)

All of the above have a similar set of base options and will get the job done. The differences come in the miscellaneous features like backup options, update options, or webhooks. I'm a fan of lloesche's image due to the large amount of customizable environment variables and extensive documentation, and it's the one I'll be using for the following configuration examples.

For your server doing the hosting, lloesche recommends a minimum of a [dual core system with 4 GB of RAM](https://github.com/lloesche/valheim-server-docker#system-requirements), with increasing core count and RAM requirements per additional player. A maximum of 10 players is supported by the server.

## File Structure

Before proceeding, I like to use a "Docker" folder specifically to hold subfolders for various service data, which containers will read or write from via specified volumes. My structure for Valheim is similar to the following:

services/

|-- valheim-server/

| |-- backups/

| |-- config/

| |-- data/

| |-- .env

| `-- docker-compose.yml

`backups` contains copies of the game world, created at set intervals.
`config` contains the generated world and any admin config.
`data` contains the downloaded server binaries.
`docker-compose.yml` contains the image reference, volumes pointing to the above folders, and other config.
`.env` (optional) contains environment-specific variables. I also like to put secrets in here, like passwords.

Any convenient location on your hosting device's filesystem should work, as long as Docker has access to it. Note that these these folders and files should be created beforehand, they'll just be empty and blank for now.

## Docker Compose

This is the meat. To start with, the file `docker-compose.yml` can be populated very similarly to the below sample file. Note that YAML requires correct indentations.

```yml
services:
    valheim-server:
        image: ghcr.io/lloesche/valheim-server:latest
        container_name: valheim-server
		cap_add:
		    - sys_nice
		environment:
		    PUID: ReplaceMe
		    PGID: ReplaceMe
		    TZ: America/Los_Angeles
		    SERVER_NAME: MyEpicServer
            WORLD_NAME: MyWorldName
            SERVER_PASS: 12345
		volumes:
            - ./config:/config
            - ./data:/opt/valheim
            - ./backups:/backups
		ports:
		    - 2456-2457:2456-2457/udp
        restart: unless-stopped
```

We're specifying that we want to pull the `lloesche/valheim-server` image from the GitHub Container Registry, with a name of "valheim-server". We've provided a baseline set of options for this particular image, like world name and password, and specified volumes pointing to the three folders previously created. This image references /opt/valheim internally to store downloaded server files, which we're just mapping to /data on our filesystem.

PUID and PGID are specific to your environment and identify the user and group running the container. On Linux, these values for the _current user_ can be retrieved via commands `id -u` and `id -g`.

TZ can be populated with the [timezone reference](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones) of wherever you are in the world.

You'll probably want a decent password too if you want to avoid the riffraff logging in to your server...although that could be a whole new element of fun. The minimum is 5 characters.

![](/images/valheim-docker/spaceballs.jpg 'Spaceballs Password')

Otherwise...that's about 90% of the way to having a functional server. The last bit of configuration is opening up external access.

## Port Forwarding

Port forwarding consists of configuring your router to, well, forward specific ports for a given IP within the local network (in this case, the server). This allows outside traffic to access internal resources through those particular ports. In our compose file, we included this line `2456-2457:2456-2457/udp` in the ports section. Similarly to volumes, the container references a port range internally, and I've mapped them to the identical outside port range for simplicity. Some older documentation may include port 2458, which is no longer needed.

In most consumer routers, port forwarding is usually located under "Advanced" or "Administration" sections of the router home screen settings.

On my Netgear router, the process is navigating to Advanced Setup > Port Forwarding/Port Triggering, adding a custom service, and specifying external port range 2456-2457 (with TCP/UDP protocol) for the internal IP address 192.168.1.2 (my Synology NAS).

![](/images/valheim-docker/valheim_ports.jpg 'Valheim Ports')

Additionally, make sure your hosting server has a static IP. Otherwise its router assigned IP could change in the future, invalidating the port forwarding setup.

## Starting and Connecting

Navigate to the directory containing your docker-compose.yml and run the command:

```yml
docker-compose up -d
```

That's it.

`up` creates and starts the container, and `-d` runs it in detached mode, freeing up the terminal.

It may take a few minutes for the first-time download and subsequent startup to finish, but at this point the Valheim server container is configured, connectable, and running, with no further steps required. You can jump in game, filter for your server name in the server list, and start playing!

## Additional Fluff

In case things were too easy. Discord notifications, .env files, and other shenanigans.

### Discord Webhooks

This part gets a little messy with the backslash extravaganza.

```yml
POST_SERVER_LISTENING_HOOK: 'curl -sfSL -X POST -H "Content-Type: application/json" -d "{\"username\":\"Valheim\",\"embeds\":[{\"title\":\"Start\"\"description\":\"Server Status: Ready to Connect!\",\"color\":3066993}]}" "${DISCORD_WEBHOOK}"'
PRE_SERVER_SHUTDOWN_HOOK: 'curl -sfSL -X POST -H "Content-Type: application/json" -d "{\"username\":\"Valheim\",\"embeds\":[{\"title\":\"Stop\"\"description\":\"Server Status: Shutting Down\",\"color\":15158332}]}" "${DISCORD_WEBHOOK}"'
```

```bash
DISCORD_WEBHOOK=https://discord.com/api/webhooks/{numbers}/{letters-and-numbers}
```

Note I'm making use of variable substitution in the compose file, the values are populated from the .env file (which must be in the same directory).

This post is an insurance policy. Ever heard of the [Bus Factor](https://en.wikipedia.org/wiki/Bus_factor)? Needless to say, my Valheim server must keep running, the metals must be mined, and the crops must be tended. Here's a starter on setting up a self-hosted dedicated 24/7 Valheim server (with Discord notifications).

TL;DR, the benefits of self-hosting your own dedicated, containerized Valheim server:

- Can run independently of your gaming PC
- Operates in a sandboxed environment
- Customizable to your heart's content
- No need to pay for a third-party provider

## Tips and Addendum

- Your generated world is seeded from the World Name you provide.
- Backup your world, ideally to an external location. You don't want to lose hundreds of hours of progress if things go south!
- A tip

## Room For Improvement

I'd like to come up with a more accessible way to start, stop, or restart the server than through scripts or command line.Discord commands would be perfect, but I'm not sure how to approach it yet.

## Further Reading

[Valheim Dedicated Server Manual (PDF)](https://higashi-kyoto.tokyo/wp-content/uploads/2021/02/Valheim-Dedicated-Server-Manual.pdf)
[lloesche/valheim-server README.md](https://github.com/lloesche/valheim-server-docker#readme)

## Conclusion

Hopefully that's a good baseline to start from.

And to future me who's (still) playing Valheim, you're welcome.
